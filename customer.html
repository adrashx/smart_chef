<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snack Center Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 pb-32 select-none">

    <!-- Header -->
    <header class="bg-white p-4 shadow-sm sticky top-0 z-20 flex justify-between items-center border-b border-gray-100">
        <div>
            <h1 class="text-2xl font-black text-gray-800 tracking-tight">Snack Center</h1>
            <div class="flex items-center gap-2 mt-1">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <p class="text-gray-500 text-xs font-bold uppercase tracking-wider">Live Menu</p>
            </div>
        </div>
        <div class="bg-orange-50 px-3 py-1 rounded-lg border border-orange-100">
            <p class="text-orange-800 text-xs font-bold uppercase">Table</p>
            <p class="text-orange-600 text-xl font-black leading-none text-center" id="table-num">--</p>
        </div>
    </header>

    <!-- Category Nav -->
    <div class="sticky top-[85px] z-10 bg-white/95 backdrop-blur border-b border-gray-200 shadow-sm">
        <div class="flex overflow-x-auto gap-3 p-3 hide-scrollbar" id="category-container">
            <!-- Categories injected here -->
        </div>
    </div>

    <!-- Menu Grid -->
    <div id="menu-container" class="p-4 grid gap-4 sm:grid-cols-2 max-w-3xl mx-auto">
        <!-- Items injected here -->
    </div>

    <!-- Floating Cart -->
    <div id="cart-bar" class="fixed bottom-4 left-4 right-4 bg-gray-900 text-white rounded-2xl shadow-2xl p-4 z-50 hidden transform transition-all duration-300 translate-y-24 opacity-0">
        <div class="flex justify-between items-center">
            <div class="flex flex-col">
                <span class="text-gray-400 text-xs uppercase font-bold tracking-wider">Total Order</span>
                <div class="flex items-baseline gap-1">
                    <span class="text-2xl font-bold">₹</span>
                    <span class="text-3xl font-black" id="cart-total">0</span>
                </div>
                <span class="text-xs text-gray-400 mt-1"><span id="cart-count" class="text-white font-bold">0</span> items selected</span>
            </div>
            <button onclick="placeOrder()" id="order-btn" class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform active:scale-95 transition-all flex items-center gap-2">
                <span>Place Order</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            </button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black/80 z-50 hidden items-center justify-center p-6 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl transform scale-100">
            <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h2 class="text-3xl font-black text-gray-900 mb-2">Order Sent!</h2>
            <p class="text-gray-500 mb-8 font-medium">The kitchen has received your request for <span class="font-bold text-gray-800">Table <span id="modal-table"></span></span>.</p>
            <button onclick="resetApp()" class="w-full py-4 bg-gray-900 text-white font-bold rounded-xl hover:bg-black transition transform active:scale-95">Order More Items</button>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz6iECjxKAcJn7V44UD5WPw0OJ7fmDf6Ct6i50PTf479kebDfJFO7Y-GSh5KlOlIOkKfQ/exec";
        
        // --- DATA ---
        const MENU = [
            { id: 1, cat: "Classics", name: "वडापाव", price: 20 },
            { id: 2, cat: "Classics", name: "मिसळ पाव", price: 80 },
            { id: 3, cat: "Classics", name: "पोहे", price: 20 },
            { id: 4, cat: "Classics", name: "तऱी पोहे", price: 25 },
            { id: 5, cat: "Classics", name: "दही पोहे", price: 25 },
            { id: 6, cat: "Bhaji", name: "मूग भजी", price: 40 },
            { id: 7, cat: "Bhaji", name: "कांदा भजी", price: 30 },
            { id: 8, cat: "Bhaji", name: "बटाटा भजी", price: 30 },
            { id: 9, cat: "Bhaji", name: "पालक भजी", price: 30 },
            { id: 10, cat: "Bhaji", name: "मिक्स भजी", price: 30 },
            { id: 11, cat: "Bhaji", name: "गोल भजी", price: 30 },
            { id: 12, cat: "Bhaji", name: "ब्रेड पॅटिस", price: 25 },
            { id: 13, cat: "Bhaji", name: "चीज ब्रेड पॅटिस", price: 45 },
            { id: 14, cat: "Upwas", name: "साबूदाणा खिचडी", price: 35 },
            { id: 15, cat: "Upwas", name: "साबूदाणा वडा", price: 45 },
            { id: 16, cat: "Fusion", name: "उलटा वडापाव", price: 25 },
            { id: 17, cat: "Fusion", name: "चीज वडापाव", price: 50 },
            { id: 18, cat: "Fusion", name: "चीज बेस्ट वडापाव", price: 65 },
            { id: 19, cat: "Fusion", name: "चीज बटर वडापाव", price: 55 },
            { id: 20, cat: "Fusion", name: "पनीर वडापाव", price: 45 },
            { id: 21, cat: "Fusion", name: "पनीर चीज वडापाव", price: 55 },
            { id: 22, cat: "Fusion", name: "सॅम्पल वडापाव", price: 40 },
            { id: 23, cat: "Fusion", name: "दही सॅम्पल वडापाव", price: 50 },
            { id: 24, cat: "Fusion", name: "सेंडविच वडापाव", price: 40 },
            { id: 25, cat: "Fusion", name: "मेयोनिज वडापाव", price: 40 },
            { id: 26, cat: "Fusion", name: "पिरी पिरी वडापाव", price: 40 },
            { id: 27, cat: "Beverages", name: "चहा", price: 12 },
            { id: 28, cat: "Beverages", name: "मसाला चहा", price: 15 },
            { id: 29, cat: "Beverages", name: "कॉफी", price: 20 },
            { id: 30, cat: "Beverages", name: "ताक", price: 20 },
            { id: 31, cat: "Extras", name: "एक्स्ट्रा पाव", price: 4 },
            { id: 32, cat: "Extras", name: "सिंगल वडा", price: 17 },
        ];

        // --- STATE ---
        let cart = {};
        let currentCat = "Classics";
        let tableNumber = 1;

        // --- INIT ---
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            tableNumber = params.get('table') || 1;
            document.getElementById('table-num').innerText = tableNumber;
            renderCategories();
            renderMenu();
        };

        function renderCategories() {
            const cats = [...new Set(MENU.map(m => m.cat))];
            const container = document.getElementById('category-container');
            container.innerHTML = cats.map(c => `
                <button onclick="filterCat('${c}')" 
                    class="px-5 py-3 rounded-xl whitespace-nowrap text-sm font-bold transition-all transform active:scale-95 ${currentCat === c ? 'bg-gray-800 text-white shadow-lg' : 'bg-white text-gray-600 border border-gray-200 shadow-sm'}">
                    ${c}
                </button>
            `).join('');
        }

        function filterCat(cat) {
            currentCat = cat;
            renderCategories();
            renderMenu();
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            const items = MENU.filter(m => m.cat === currentCat);
            container.innerHTML = items.map(item => `
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between h-full relative overflow-hidden group">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-gray-800 text-lg leading-tight pr-2">${item.name}</h3>
                        <span class="text-orange-600 font-black text-lg">₹${item.price}</span>
                    </div>
                    <button onclick="addToCart(${item.id})" class="w-full py-3 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-xl active:scale-95 transition font-bold flex items-center justify-center gap-2 group-hover:bg-orange-500 group-hover:text-white">
                        ADD TO ORDER
                    </button>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const item = MENU.find(i => i.id === id);
            if (cart[id]) cart[id].count++;
            else cart[id] = { ...item, count: 1 };
            updateCartUI();
            
            // Haptic feedback simulation
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function updateCartUI() {
            const items = Object.values(cart);
            const total = items.reduce((sum, i) => sum + (i.price * i.count), 0);
            const count = items.reduce((sum, i) => sum + i.count, 0);
            
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-total').innerText = total;
            
            const bar = document.getElementById('cart-bar');
            if (count > 0) {
                bar.classList.remove('hidden', 'translate-y-24', 'opacity-0');
            } else {
                bar.classList.add('translate-y-24', 'opacity-0');
                setTimeout(() => bar.classList.add('hidden'), 300);
            }
        }

        function placeOrder() {
            const btn = document.getElementById('order-btn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
            btn.disabled = true;

            const orderData = {
                action: 'create',
                table: tableNumber,
                items: Object.values(cart).map(i => ({ name: i.name, count: i.count, price: i.price })),
                total: Object.values(cart).reduce((sum, i) => sum + (i.price * i.count), 0)
            };

            // NOTE: using no-cors because Google Script triggers don't return proper CORS headers for POST
            // We assume success if no network error is thrown.
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData)
            }).then(() => {
                document.getElementById('modal-table').innerText = tableNumber;
                document.getElementById('success-modal').style.display = 'flex';
                cart = {};
                updateCartUI();
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }).catch(err => {
                alert("FAILED to connect to kitchen. Please try again or call waiter.");
                console.error(err);
                btn.innerHTML = originalContent;
                btn.disabled = false;
            });
        }

        function resetApp() {
            document.getElementById('success-modal').style.display = 'none';
        }
    </script>
</body>
</html>